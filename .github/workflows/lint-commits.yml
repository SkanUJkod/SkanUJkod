name: Validate Commit Messages

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]
  push:
    branches-ignore:
      - "**/dependabot/**"

jobs:
  check-commit-messages:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Get commit messages from current push
        id: commits
        run: |
          COMMIT_MSG=$(git log -1 --pretty=%B | head -n1)
          echo "message=$COMMIT_MSG" >> $GITHUB_OUTPUT

      - name: Validate commit message convention
        run: |
          VALID=1
          echo "üîç Validating commit messages..."

          if [[ ! "$MSG" =~ ^(FEAT|BUG|CHORE|TEST|DOCS|REFACTOR)\([a-zA-Z0-9_-]+\):\ [A-Z][^\.\n]+$ ]]; then
            echo "‚ùå Commit message '$MSG' is invalid."
            echo ""
            echo "‚ùó Commit message must follow this format:"
            echo "  TYPE(Scope): Description"
            echo ""
            echo "TYPE: FEAT, BUG, CHORE, TEST, DOCS, REFACTOR"
            echo "Scope: module or component in parentheses"
            echo "Description: no trailing period, no need for uppercase start"
            exit 1
          fi
